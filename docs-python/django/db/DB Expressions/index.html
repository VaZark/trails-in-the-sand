<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Vaz&#39;s Corner RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Vaz&#39;s Corner Atom Feed"><title data-react-helmet="true">Efficient filtering over Querysets | Vaz&#x27;s Corner</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://vazark.github.com/docs-python/django/db/DB Expressions"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-docs-python-current"><meta data-react-helmet="true" property="og:title" content="Efficient filtering over Querysets | Vaz&#x27;s Corner"><meta data-react-helmet="true" name="description" content="F expression"><meta data-react-helmet="true" property="og:description" content="F expression"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://vazark.github.com/docs-python/django/db/DB Expressions"><link data-react-helmet="true" rel="alternate" href="https://vazark.github.com/docs-python/django/db/DB Expressions" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://vazark.github.com/docs-python/django/db/DB Expressions" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d9d837ef.css">
<link rel="preload" href="/assets/js/runtime~main.e1683013.js" as="script">
<link rel="preload" href="/assets/js/main.b54b3807.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">127.0.0.1</b></a><a class="navbar__item navbar__link" href="/docs/">TIL</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/VaZark/vazark.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs-python/Basics/Cheatsheet">Python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_TwRn" href="/docs-python/django/">Django</a><button aria-label="Toggle the collapsible sidebar category &#x27;Django&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs-python/django/basics/DRF POST : Accessing data and files">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs-python/django/db/DB Expressions">DB</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs-python/django/db/DB Expressions">Efficient filtering over Querysets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-python/django/db/Extensible design with Django Polymorphic">Extensible design with Django Polymorphic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-python/django/db/Managers">Managers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-python/django/db/Migrating model across apps">Model migration across apps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-python/django/db/Onboarding existing tables">Onboarding existing tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-python/django/db/Prefetching">Prefetching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-python/django/db/Querysets">Querysets</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs-python/django/drf/Custom Validations">DRF</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs-python/django/admin/Custom Actions">Admin</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-python/">Python Docs</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Efficient filtering over Querysets</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="f-expression">F expression<a class="hash-link" href="#f-expression" title="Direct link to heading">‚Äã</a></h2><p>Instances of F() act as a reference to a model field within a query. All Python does, through Django‚Äôs F() class, is create the SQL syntax to refer to the field and describe the operation. The application doesn&#x27;t retrieve data, perform the operation and store it again; the operation is self-contained in the DB as the app merely tells the DB the logic to run. Naturally, this also helps us side-step any <em>race condition</em> related issues</p><p>These references can also be used in query filters to compare the values of two different fields on the same model instance</p><p>With constants and with other F() objects, F() objects supports</p><ul><li>addition</li><li>subtraction</li><li>multiplication</li><li>division</li><li>modulo</li><li>power arithmetic </li><li>timedelta (for date/time objects)</li></ul><p>For related objects referenced, an F() object with a double underscore will introduce any joins needed to access the related object.However, you can‚Äôt introduce joins when you use F() objects in an update ‚Äì you can only reference fields local to the model being updated</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="q-objects">Q Objects<a class="hash-link" href="#q-objects" title="Direct link to heading">‚Äã</a></h2><p>Q objects provides you complete control over the where clause of the query.</p><p>Usually any functions over the queryset are ‚ÄúAND‚Äùed together. Q objects allow the developer to easily define AND, OR, NOT and any futher nesting of the same into complex logic.</p><p>Lookup functions can mix the use of Q objects and keyword arguments. However, if a Q object is provided, it must precede the definition of any keyword arguments. </p><div class="codeBlockContainer_J+bg language-python theme-code-block"><div class="codeBlockContent_csEI python"><pre tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">queryset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Q</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_name__startswith</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;R&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">~</span><span class="token plain">Q</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">last_name__endswith</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;son&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="annotate">Annotate<a class="hash-link" href="#annotate" title="Direct link to heading">‚Äã</a></h2><h2 class="anchor anchorWithStickyNavbar_y2LR" id="aggregate">Aggregate<a class="hash-link" href="#aggregate" title="Direct link to heading">‚Äã</a></h2><h2 class="anchor anchorWithStickyNavbar_y2LR" id="conditional">Conditional<a class="hash-link" href="#conditional" title="Direct link to heading">‚Äã</a></h2><h2 class="anchor anchorWithStickyNavbar_y2LR" id="other-operations">Other operations<a class="hash-link" href="#other-operations" title="Direct link to heading">‚Äã</a></h2><p><strong>With other queryset</strong></p><ul><li>union(*qses) : All distinct entries in all the Querysets</li><li>intersection(*qses) : All distinct entries common to all hte Querysets</li><li>difference(*qses) : All entries unique to Queryset onject it is called on</li></ul><p><strong>With Related Models</strong></p><ul><li>select_related : Get all the related single-valued relationships (foreign key and one-to-one) referenced by objects of a Queryset</li><li>prefetch_related : Gets all related data that has been referenced by the objects in the queryset. Used to bypass the 1+N problem<ul><li>To clear any prefetch_related behavior, pass <code>None</code> as a parameter</li><li>prefetch_related_objects is separate function does this on an existing iterable of models</li></ul></li></ul><p><strong>With the Model</strong></p><ul><li><p>get_or_create</p></li><li><p>update_or_create</p></li><li><p>select_for_update : Returns a queryset that will lock rows until the end of the transaction (on supported databases)</p></li><li><p>bulk_create : Inserts the provided list of Model objects into the database </p><ul><li>The model‚Äôs save() method will not be called, and the pre_save and post_save signals will not be sent.</li><li>It does not work with child models in a multi-table inheritance</li><li>Doesn&#x27;t work with M2M relations</li></ul></li><li><p>bulk_update : Updates the provided list of Model objects into the database </p><ul><li>Each model‚Äôs save() method isn‚Äôt called, and the pre_save and post_save signals aren‚Äôt sent.</li><li>You cannot update the model‚Äôs primary key.</li><li>If updating a large number of columns in a large number of rows, the SQL generated can be very large. Avoid this by specifying a suitable   - batch_size.</li><li>Updating fields defined on multi-table inheritance ancestors will incur an extra query per ancestor.</li></ul></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-python/django/basics/Django Model Instance - Validation and Overriding"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Django Model Instance - Validation and Overriding</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-python/django/db/Extensible design with Django Polymorphic"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Extensible design with Django Polymorphic</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#f-expression" class="table-of-contents__link toc-highlight">F expression</a></li><li><a href="#q-objects" class="table-of-contents__link toc-highlight">Q Objects</a></li><li><a href="#annotate" class="table-of-contents__link toc-highlight">Annotate</a></li><li><a href="#aggregate" class="table-of-contents__link toc-highlight">Aggregate</a></li><li><a href="#conditional" class="table-of-contents__link toc-highlight">Conditional</a></li><li><a href="#other-operations" class="table-of-contents__link toc-highlight">Other operations</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs-python/Django">Django</a></li><li class="footer__item"><a class="footer__link-item" href="/docs-devops/aws">AWS</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/in/vazm/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/vazarks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.e1683013.js"></script>
<script src="/assets/js/main.b54b3807.js"></script>
</body>
</html>