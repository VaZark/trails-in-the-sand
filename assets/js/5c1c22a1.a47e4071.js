"use strict";(self.webpackChunktil_remaster=self.webpackChunktil_remaster||[]).push([[1851],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,f=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},599:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],l={},s="Efficient filtering over Querysets",u={unversionedId:"django/db/DB Expressions",id:"django/db/DB Expressions",title:"Efficient filtering over Querysets",description:"F expression",source:"@site/docs-python/django/db/DB Expressions.md",sourceDirName:"django/db",slug:"/django/db/DB Expressions",permalink:"/docs-python/django/db/DB Expressions",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Django Model Instance - Validation and Overriding",permalink:"/docs-python/django/basics/Django Model Instance - Validation and Overriding"},next:{title:"Extensible design with Django Polymorphic",permalink:"/docs-python/django/db/Extensible design with Django Polymorphic"}},c=[{value:"F expression",id:"f-expression",children:[],level:2},{value:"Q Objects",id:"q-objects",children:[],level:2},{value:"Annotate",id:"annotate",children:[],level:2},{value:"Aggregate",id:"aggregate",children:[],level:2},{value:"Conditional",id:"conditional",children:[],level:2},{value:"Other operations",id:"other-operations",children:[],level:2}],p={toc:c};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"efficient-filtering-over-querysets"},"Efficient filtering over Querysets"),(0,o.kt)("h2",{id:"f-expression"},"F expression"),(0,o.kt)("p",null,"Instances of F() act as a reference to a model field within a query. All Python does, through Django\u2019s F() class, is create the SQL syntax to refer to the field and describe the operation. The application doesn't retrieve data, perform the operation and store it again; the operation is self-contained in the DB as the app merely tells the DB the logic to run. Naturally, this also helps us side-step any ",(0,o.kt)("em",{parentName:"p"},"race condition")," related issues"),(0,o.kt)("p",null,"These references can also be used in query filters to compare the values of two different fields on the same model instance"),(0,o.kt)("p",null,"With constants and with other F() objects, F() objects supports"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"addition"),(0,o.kt)("li",{parentName:"ul"},"subtraction"),(0,o.kt)("li",{parentName:"ul"},"multiplication"),(0,o.kt)("li",{parentName:"ul"},"division"),(0,o.kt)("li",{parentName:"ul"},"modulo"),(0,o.kt)("li",{parentName:"ul"},"power arithmetic "),(0,o.kt)("li",{parentName:"ul"},"timedelta (for date/time objects)")),(0,o.kt)("p",null,"For related objects referenced, an F() object with a double underscore will introduce any joins needed to access the related object.However, you can\u2019t introduce joins when you use F() objects in an update \u2013 you can only reference fields local to the model being updated"),(0,o.kt)("h2",{id:"q-objects"},"Q Objects"),(0,o.kt)("p",null,"Q objects provides you complete control over the where clause of the query."),(0,o.kt)("p",null,"Usually any functions over the queryset are \u201cAND\u201ded together. Q objects allow the developer to easily define AND, OR, NOT and any futher nesting of the same into complex logic."),(0,o.kt)("p",null,"Lookup functions can mix the use of Q objects and keyword arguments. However, if a Q object is provided, it must precede the definition of any keyword arguments. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"queryset = User.objects.filter(\n    Q(first_name__startswith='R') | ~Q(last_name__endswith='son')\n)\n")),(0,o.kt)("h2",{id:"annotate"},"Annotate"),(0,o.kt)("h2",{id:"aggregate"},"Aggregate"),(0,o.kt)("h2",{id:"conditional"},"Conditional"),(0,o.kt)("h2",{id:"other-operations"},"Other operations"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"With other queryset")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"union(*qses) : All distinct entries in all the Querysets"),(0,o.kt)("li",{parentName:"ul"},"intersection(*qses) : All distinct entries common to all hte Querysets"),(0,o.kt)("li",{parentName:"ul"},"difference(*qses) : All entries unique to Queryset onject it is called on")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"With Related Models")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"select_related : Get all the related single-valued relationships (foreign key and one-to-one) referenced by objects of a Queryset"),(0,o.kt)("li",{parentName:"ul"},"prefetch_related : Gets all related data that has been referenced by the objects in the queryset. Used to bypass the 1+N problem",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"To clear any prefetch_related behavior, pass ",(0,o.kt)("inlineCode",{parentName:"li"},"None")," as a parameter"),(0,o.kt)("li",{parentName:"ul"},"prefetch_related_objects is separate function does this on an existing iterable of models")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"With the Model")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"get_or_create")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"update_or_create")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"select_for_update : Returns a queryset that will lock rows until the end of the transaction (on supported databases)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"bulk_create : Inserts the provided list of Model objects into the database "),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"The model\u2019s save() method will not be called, and the pre_save and post_save signals will not be sent."),(0,o.kt)("li",{parentName:"ul"},"It does not work with child models in a multi-table inheritance"),(0,o.kt)("li",{parentName:"ul"},"Doesn't work with M2M relations"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"bulk_update : Updates the provided list of Model objects into the database "),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Each model\u2019s save() method isn\u2019t called, and the pre_save and post_save signals aren\u2019t sent."),(0,o.kt)("li",{parentName:"ul"},"You cannot update the model\u2019s primary key."),(0,o.kt)("li",{parentName:"ul"},"If updating a large number of columns in a large number of rows, the SQL generated can be very large. Avoid this by specifying a suitable   - batch_size."),(0,o.kt)("li",{parentName:"ul"},"Updating fields defined on multi-table inheritance ancestors will incur an extra query per ancestor.")))))}d.isMDXComponent=!0}}]);